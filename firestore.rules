rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Rules for the 'deals' collection
    match /deals/{dealId} {
      // Allow read if the deal is not expired
      allow read: if request.time < resource.data.expiryDate;

      // Allow delete only if request.auth.uid matches
      //a uid specified as an Admin, or if the deal is expired.
      allow delete: if request.auth.uid == "admin-uid" || request.time > resource.data.expiryDate;
    }

    // Rules for the 'sellers' collection
    match /sellers/{sellerId} {
        // Allow read, write only if the request.auth.uid is not null
        allow read, write: if request.auth != null;

       // Rules for the 'products' subcollection
      match /products/{productId} {
        //Allow read, write only if the request.auth.uid is not null
          allow read, write: if request.auth != null;

      }
       // Rules for the 'deals' subcollection
      match /deals/{dealId} {
        //Allow read, write, delete only if the request.auth.uid is not null
          allow read, write, delete: if request.auth != null;

      }
    }
    // No rules for the 'users' collection as they are not relevant.
  }
}